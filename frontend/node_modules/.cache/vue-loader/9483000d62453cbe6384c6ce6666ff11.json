{"remainingRequest":"/home/kien/Documents/blockchain-research/tezos-certificate/frontend/node_modules/vue-loader/lib/index.js??vue-loader-options!/home/kien/Documents/blockchain-research/tezos-certificate/frontend/src/components/details/Transaction.vue?vue&type=script&lang=js&","dependencies":[{"path":"/home/kien/Documents/blockchain-research/tezos-certificate/frontend/src/components/details/Transaction.vue","mtime":1602406216551},{"path":"/home/kien/Documents/blockchain-research/tezos-certificate/frontend/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/kien/Documents/blockchain-research/tezos-certificate/frontend/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/home/kien/Documents/blockchain-research/tezos-certificate/frontend/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/kien/Documents/blockchain-research/tezos-certificate/frontend/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCBIb21lIGZyb20gJ0AvY29tcG9uZW50cy9yb290cy9Ib21lLnZ1ZScKaW1wb3J0IFNlcnZlclJlcXVlc3QgZnJvbSAnQC9yZXF1ZXN0cy9TZXJ2ZXJSZXF1ZXN0JwppbXBvcnQgU2lnbmF0dXJlTW9kYWwgZnJvbSAnQC9jb21wb25lbnRzL21vZGFscy9TaWduYXR1cmVNb2RhbC52dWUnCi8vaW1wb3J0IEJsb2NrY2hhaW5SZXF1ZXN0IGZyb20gJ0AvcmVxdWVzdHMvQmxvY2tjaGFpblJlcXVlc3QnIAoKZXhwb3J0IGRlZmF1bHQgewogIGNvbXBvbmVudHM6IHsKICAgIEhvbWUsCiAgICBTaWduYXR1cmVNb2RhbAogIH0sCiAgZGF0YSgpIHsKICAgIHJldHVybiB7CiAgICAgIGNlcnRpZmljYXRlczogW10sCiAgICAgIHNpZ25Nb2RhbDogZmFsc2UsCiAgICAgIGVtYWlsOiBudWxsLAogICAgICBpbmRleDogMCwKICAgICAgcHJpdmF0ZUtleTogbnVsbCwKICAgICAgc2lnbkRpc2FibGVkOiBbXSwKICAgICAgYnJvYWRjYXN0RGlzYWJsZWQ6IFtdLAogICAgICBjdXJyZW50Q2VydGlmaWNhdGU6IG51bGwKICAgIH0KICB9LAogIGNyZWF0ZWQgKCkgewogICAgU2VydmVyUmVxdWVzdC5nZXRDZXJ0aWZpY2F0ZSgpLnRoZW4oY2VydGlmaWNhdGVzID0+IHsKICAgICAgY2VydGlmaWNhdGVzLmZvckVhY2goY2VydGlmaWNhdGUgPT4gewogICAgICAgIGlmKCFjZXJ0aWZpY2F0ZS5pc19icm9hZGNhc3RlZCkgewogICAgICAgICAgdGhpcy5jZXJ0aWZpY2F0ZXMucHVzaChjZXJ0aWZpY2F0ZSkKICAgICAgICB9CiAgICAgIH0pCiAgICB9KQogIH0sCiAgbWV0aG9kczogewogICAgc2hvd1NpZ25hdHVyZShlbWFpbCwgaW5kZXgpIHsKICAgICAgdGhpcy5zaWduTW9kYWwgPSB0cnVlCiAgICAgIHRoaXMuZW1haWwgPSBlbWFpbAogICAgICB0aGlzLmluZGV4ID0gaW5kZXgKICAgIH0sCiAgICBjbG9zZShrZXksIGN1cnJlbnRDZXJ0aWZpY2F0ZSkgewogICAgICB0aGlzLnByaXZhdGVLZXkgPSBrZXkKICAgICAgdGhpcy5zaWduTW9kYWwgPSBmYWxzZQogICAgICB0aGlzLmN1cnJlbnRDZXJ0aWZpY2F0ZSA9IGN1cnJlbnRDZXJ0aWZpY2F0ZQogICAgfSwKICAgIGRpc2FibGUoKSB7CiAgICAgIHRoaXMuJHNldCh0aGlzLnNpZ25EaXNhYmxlZCwgdGhpcy5pbmRleCwgdHJ1ZSkKICAgIH0sCiAgICBhc3luYyBicm9hZGNhc3QoKSB7CiAgICAgIGNvbnN0IGJsb2NrY2hhaW5IYXNoID0gYXdhaXQgQmxvY2tjaGFpblJlcXVlc3QuYnJvYWRjYXN0Q2VydGlmaWNhdGUoeyBwcml2YXRlS2V5OiB0aGlzLnByaXZhdGVLZXksIAogICAgICBjZXJ0aWZpY2F0ZTogdGhpcy5jdXJyZW50Q2VydGlmaWNhdGUgfSkKICAgICAgYXdhaXQgU2VydmVyUmVxdWVzdC5pbml0Q2VydGlmaWNhdGUoeyBjb3Vyc2VEYXRhOiB0aGlzLmN1cnJlbnRDZXJ0aWZpY2F0ZSB9KQogICAgICAKICAgICAgc2V0VGltZW91dChhc3luYyAoKSA9PiB7CiAgICAgICAgYXdhaXQgU2VydmVyUmVxdWVzdC5jcmVhdGVDZXJ0aWZpY2F0ZVBERih7IG5hbWU6IHRoaXMuY3VycmVudENlcnRpZmljYXRlLm5hbWUgfSkKICAgICAgfSwgMzAwMCkKCiAgICAgIHNldFRpbWVvdXQoYXN5bmMgKCkgPT4gewogICAgICAgIGF3YWl0IFNlcnZlclJlcXVlc3Quc2VuZENlcnRpZmljYXRlQnlNYWlsKHsgbmFtZTogdGhpcy5jdXJyZW50Q2VydGlmaWNhdGUubmFtZSwgZW1haWw6ICJkb25na3k2Nzc2QGdtYWlsLmNvbSIgfSkKICAgICAgICBhd2FpdCBTZXJ2ZXJSZXF1ZXN0LnN0b3JlSGFzaCh7IGVtYWlsOiB0aGlzLmVtYWlsLCBibG9ja2NoYWluX2hhc2g6IGJsb2NrY2hhaW5IYXNoWzBdLnJlY2VpdmVyIH0pCiAgICAgICAgdGhpcy4kc2V0KHRoaXMuYnJvYWRjYXN0RGlzYWJsZWQsIHRoaXMuaW5kZXgsIHRydWUpCiAgICAgICAgd2luZG93LkV2ZW50QnVzLiRlbWl0KCdTVUNDRVNTJywgJ1N1Y2Nlc3MnKQogICAgICB9LCA4MDAwKQogICAgfQogIH0sCiAgbW91dGVkKCkgewogICAgdGhpcy5icm9hZGNhc3REaXNhYmxlZFswXSA9IHRydWU7CiAgfSwKfQo="},{"version":3,"sources":["Transaction.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAqCA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"Transaction.vue","sourceRoot":"src/components/details","sourcesContent":["<template>\n  <div>\n    <home :activeTransaction=\"true\"/>\n    <div class=\"datatable\">\n      <table>\n        <tr>\n          <th>{{ \"Name\" }}</th>\n          <th>{{ \"Student ID\" }}</th>\n          <th>{{ \"Email\" }}</th>\n          <th>{{ \"Diploma Type\" }}</th>\n          <th>{{ \"Credential Number\" }}</th>\n          <th class=\"action\">{{ \"Action\" }}</th>\n        </tr>\n        <tr v-for=\"(certificate, index) in certificates\" :key=\"index\">\n          <td>{{ certificate.name }}</td>\n          <td>{{ certificate.identity }}</td>\n          <td>{{ certificate.email }}</td>\n          <td>{{ certificate.diploma_type }}</td>\n          <td>{{ certificate.credential_number }}</td>\n          <td class=\"action\">\n            <button \n            @click=\"showSignature(certificate.email, index)\" \n            :disabled=\"signDisabled[index]\"\n            :class=\"{ disable: signDisabled[index] }\">{{ \"Sign\" }}</button>\n            <button class=\"right-button\" \n            @click=\"broadcast()\"\n            :disabled=\"broadcastDisabled[index]\"\n            :class=\"{ disable: broadcastDisabled[index] }\">{{ \"Broadcast\" }}</button>\n          </td>\n        </tr>\n      </table>\n    </div>\n    <signature-modal v-if=\"signModal\" :email=\"email\" @close-modal=\"close\" @disable=\"disable\"/>\n  </div>\n</template>\n\n<script>\nimport Home from '@/components/roots/Home.vue'\nimport ServerRequest from '@/requests/ServerRequest'\nimport SignatureModal from '@/components/modals/SignatureModal.vue'\n//import BlockchainRequest from '@/requests/BlockchainRequest' \n\nexport default {\n  components: {\n    Home,\n    SignatureModal\n  },\n  data() {\n    return {\n      certificates: [],\n      signModal: false,\n      email: null,\n      index: 0,\n      privateKey: null,\n      signDisabled: [],\n      broadcastDisabled: [],\n      currentCertificate: null\n    }\n  },\n  created () {\n    ServerRequest.getCertificate().then(certificates => {\n      certificates.forEach(certificate => {\n        if(!certificate.is_broadcasted) {\n          this.certificates.push(certificate)\n        }\n      })\n    })\n  },\n  methods: {\n    showSignature(email, index) {\n      this.signModal = true\n      this.email = email\n      this.index = index\n    },\n    close(key, currentCertificate) {\n      this.privateKey = key\n      this.signModal = false\n      this.currentCertificate = currentCertificate\n    },\n    disable() {\n      this.$set(this.signDisabled, this.index, true)\n    },\n    async broadcast() {\n      const blockchainHash = await BlockchainRequest.broadcastCertificate({ privateKey: this.privateKey, \n      certificate: this.currentCertificate })\n      await ServerRequest.initCertificate({ courseData: this.currentCertificate })\n      \n      setTimeout(async () => {\n        await ServerRequest.createCertificatePDF({ name: this.currentCertificate.name })\n      }, 3000)\n\n      setTimeout(async () => {\n        await ServerRequest.sendCertificateByMail({ name: this.currentCertificate.name, email: \"dongky6776@gmail.com\" })\n        await ServerRequest.storeHash({ email: this.email, blockchain_hash: blockchainHash[0].receiver })\n        this.$set(this.broadcastDisabled, this.index, true)\n        window.EventBus.$emit('SUCCESS', 'Success')\n      }, 8000)\n    }\n  },\n  mouted() {\n    this.broadcastDisabled[0] = true;\n  },\n}\n</script>\n\n<!-- Add \"scoped\" attribute to limit CSS to this component only -->\n<style scoped lang=\"scss\">\n.datatable {\n  margin-top: 95px;\n}\ntable {\n  font-family: Arial, Helvetica, sans-serif;\n  border-collapse: collapse;\n  margin-left: auto;\n  margin-right: auto;\n  box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.2), 0 5px 5px 0 rgba(0, 0, 0, 0.24);\n}\n\nth {\n  text-align: center;\n  color: #D5DDE5;\n  background: #333333;\n  font-size: 15px;\n  font-weight: 600;\n  padding: 20px;\n}\ntd {\n  vertical-align: middle;\n  font-size: 13px;\n  text-shadow: -1px -1px 1px rgba(0, 0, 0, 0.1);\n  padding: 20px;\n}\n.action {\n  padding-right: 30px;\n}\nbutton {\n  background: #000000;\n  width: 100px;\n  border: 0;\n  padding: 13px;\n  color: #FFFFFF;\n  font-size: 13px;\n  border-radius: 3px;\n  height: 40px;\n  position: relative;\n  cursor: pointer;\n}\nbutton.disable {\n  background: #625D5D;\n}\n.right-button {\n  margin-left: 5px;\n}\n.right-button.disable {\n  background: #625D5D;\n}\n</style>\n"]}]}